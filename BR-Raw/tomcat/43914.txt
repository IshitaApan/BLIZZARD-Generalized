HTTP spec violation when generating HTTP redirects for folders without trailing slash

Copy the attached static.war into $CATALINA_HOME/webapps. Then start the server and paste this HTTP request in netcat: GET /static/name%20with%20spaces HTTP/1.1 User-Agent: Jakarta Commons-HttpClient/3.0 Host: localhost:8080 Tomcat will answer with the following HTTP redirect: HTTP/1.1 302 Moved Temporarily Server: Apache-Coyote/1.1 Location: http://localhost:8080/static/name with spaces/ Transfer-Encoding: chunked Date: Tue, 20 Nov 2007 13:46:12 GMT Observe the Location: header. It has raw unencoded spaces in the URL which is in clear violation of the HTTP specification.
DeltaManager doesn't do the session replication. (notifySessionListenersOnReplication=false)

DeltaManager is used. When notifySessionListenersOnReplication is set to false, session replication is not done. This cause is in the following DeltaManager#handleSESSION_CREATED's codes. protected void handleSESSION_CREATED(SessionMessage msg,Member sender) { ... if(notifySessionListenersOnReplication) session.setId(msg.getSessionID()); else session.setIdInternal(msg.getSessionID()); session.resetDeltaRequest(); session.endAccess(); } When notifySessionListenersOnReplication is false, only session.setIdInternal is executed. Session is not added to session map of DeltaManager in session.setIdInternal method. As a result, session replication is not done. When notifySessionListenersOnReplication is false, I think that I should add session to session map of DeltaManager. For instance, as follows. [start.] Index: java/org/apache/catalina/ha/session/DeltaManager.java =================================================================== --- java/org/apache/catalina/ha/session/DeltaManager.java	(revision 763870) +++ java/org/apache/catalina/ha/session/DeltaManager.java	(working copy) @@ -1435,10 +1435,12 @@ // use container maxInactiveInterval so that session will expire correctly in case of primary transfer session.setMaxInactiveInterval(getMaxInactiveInterval()); session.access(); - if(notifySessionListenersOnReplication) + if(notifySessionListenersOnReplication) { session.setId(msg.getSessionID()); - else + } else { session.setIdInternal(msg.getSessionID()); + add(session); + } session.resetDeltaRequest(); session.endAccess(); [end.] Best regards.
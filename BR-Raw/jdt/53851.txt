extract method in anonymous class introduces error [refactoring]

Test case: public class Bug { void test () { new Object () { public void yes () { System.out.println ("hello world"); } }; System.out.println ("hello world"); } } Three (possibly related) problems: 1. Select the first print statement (whole line). Refactor:Extract Method..., enter some name and press OK, leaving "replace 1 duplicate code fragment" checked. The method is created inside the anonymous class but called from outside. 2. Select the second print statement (whole line). Refactor:Extract Method... The duplicate code fragment is not recognized. 3. Select only "println" in either print statement. Refactor:Extract Method..., enter some name and press OK. You get a strange error message: "Cannot determine expression's return type. Using void instead." Pressing Continue produces meaningless code.
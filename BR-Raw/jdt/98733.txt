[templates] probe formatter when applying templates

N20050607 see bug 98037 - basically, in order to get template formatting right, we have to probe the different formatter kinds in a specified order. Fix is trivial - format using K_EXPRESSION, K_STATEMENTS and K_UNKWOWN until the formatter finds something to format, e.g. returns a non-null edit. 3.1 candidate.
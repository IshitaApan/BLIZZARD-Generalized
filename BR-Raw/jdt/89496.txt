[nls tooling] Illegal state exception when previewing changes in externalize string wizard

M6 test pass Steps to reproduce: package externalize; public class Test { public void foo() { String s= "Eclipse"; } } - externalize string - don't use Eclipse option - press next - press next click on the node Create file .... Dani, if there is anything refactoring can do to avoid this, please move back. java.lang.IllegalStateException 	at org.eclipse.jface.text.TextViewer.setHyperlinkPresenter(TextViewer.java:5196) 	at org.eclipse.jface.text.source.SourceViewer.configure(SourceViewer.java:353) 	at org.eclipse.jdt.internal.ui.refactoring.CreateTextFileChangePreviewViewer.setInput(CreateTextFileChangePreviewViewer.java:82) 	at org.eclipse.ltk.internal.ui.refactoring.DefaultChangeElement.feedInput(DefaultChangeElement.java:61) 	at org.eclipse.ltk.internal.ui.refactoring.PreviewWizardPage.showPreview(PreviewWizardPage.java:376) 	at org.eclipse.ltk.internal.ui.refactoring.PreviewWizardPage.access$2(PreviewWizardPage.java:355) 	at org.eclipse.ltk.internal.ui.refactoring.PreviewWizardPage$2.selectionChanged(PreviewWizardPage.java:346) 	at org.eclipse.jface.viewers.Viewer$2.run(Viewer.java:162) 	at org.eclipse.core.internal.runtime.InternalPlatform.run(InternalPlatform.java:1021) 	at org.eclipse.core.runtime.Platform.run(Platform.java:757) 	at org.eclipse.ui.internal.JFaceUtil$1.run(JFaceUtil.java:40) 	at org.eclipse.jface.util.SafeRunnable.run(SafeRunnable.java:148) 	at org.eclipse.jface.viewers.Viewer.fireSelectionChanged(Viewer.java:160) 	at org.eclipse.jface.viewers.StructuredViewer.updateSelection(StructuredViewer.java:1691) 	at org.eclipse.jface.viewers.StructuredViewer.handleSelect(StructuredViewer.java:934) 	at org.eclipse.jface.viewers.CheckboxTreeViewer.handleSelect(CheckboxTreeViewer.java:267) 	at org.eclipse.jface.viewers.StructuredViewer$4.widgetSelected(StructuredViewer.java:960) 	at org.eclipse.jface.util.OpenStrategy.fireSelectionEvent(OpenStrategy.java:209) 	at org.eclipse.jface.util.OpenStrategy.access$3(OpenStrategy.java:204) 	at org.eclipse.jface.util.OpenStrategy$1.handleEvent(OpenStrategy.java:364) 	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:842) 	at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:2894) 	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2527) 	at org.eclipse.jface.window.Window.runEventLoop(Window.java:803) 	at org.eclipse.jface.window.Window.open(Window.java:781) 	at org.eclipse.ltk.ui.refactoring.RefactoringWizardOpenOperation$1.run(RefactoringWizardOpenOperation.java:125) 	at org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:69) 	at org.eclipse.ltk.ui.refactoring.RefactoringWizardOpenOperation.run(RefactoringWizardOpenOperation.java:138) 	at org.eclipse.jdt.internal.ui.refactoring.actions.RefactoringStarter.activate(RefactoringStarter.java:40) 	at org.eclipse.jdt.ui.actions.ExternalizeStringsAction.openExternalizeStringsWizard(ExternalizeStringsAction.java:147) 	at org.eclipse.jdt.ui.actions.ExternalizeStringsAction$1.run(ExternalizeStringsAction.java:120) 	at org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:69) 	at org.eclipse.jdt.ui.actions.ExternalizeStringsAction.run(ExternalizeStringsAction.java:117) 	at org.eclipse.jdt.ui.actions.ExternalizeStringsAction.run(ExternalizeStringsAction.java:99) 	at org.eclipse.jdt.ui.actions.SelectionDispatchAction.dispatchRun(SelectionDispatchAction.java:216) 	at org.eclipse.jdt.ui.actions.SelectionDispatchAction.run(SelectionDispatchAction.java:188) 	at org.eclipse.jface.action.Action.runWithEvent(Action.java:996) 	at org.eclipse.jface.action.ActionContributionItem.handleWidgetSelection(ActionContributionItem.java:538) 	at org.eclipse.jface.action.ActionContributionItem.access$2(ActionContributionItem.java:488) 	at org.eclipse.jface.action.ActionContributionItem$5.handleEvent(ActionContributionItem.java:400) 	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:842) 	at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:2894) 	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2527) 	at org.eclipse.jdt.internal.ui.actions.QuickMenuAction.run(QuickMenuAction.java:77) 	at org.eclipse.jface.action.Action.runWithEvent(Action.java:996) 	at org.eclipse.ui.commands.ActionHandler.execute(ActionHandler.java:182) 	at org.eclipse.ui.internal.handlers.LegacyHandlerWrapper.execute(LegacyHandlerWrapper.java:108) 	at org.eclipse.core.commands.Command.execute(Command.java:331) 	at org.eclipse.core.commands.ParameterizedCommand.execute(ParameterizedCommand.java:396) 	at org.eclipse.ui.internal.keys.WorkbenchKeyboard.executeCommand(WorkbenchKeyboard.java:452) 	at org.eclipse.ui.internal.keys.WorkbenchKeyboard.press(WorkbenchKeyboard.java:741) 	at org.eclipse.ui.internal.keys.WorkbenchKeyboard.processKeyEvent(WorkbenchKeyboard.java:784) 	at org.eclipse.ui.internal.keys.WorkbenchKeyboard.filterKeySequenceBindings(WorkbenchKeyboard.java:543) 	at org.eclipse.ui.internal.keys.WorkbenchKeyboard.access$3(WorkbenchKeyboard.java:486) 	at org.eclipse.ui.internal.keys.WorkbenchKeyboard$KeyDownFilter.handleEvent(WorkbenchKeyboard.java:110) 	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:82) 	at org.eclipse.swt.widgets.Display.filterEvent(Display.java:777) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:841) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:866) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:851) 	at org.eclipse.swt.widgets.Control.traverse(Control.java:2770) 	at org.eclipse.swt.widgets.Control.translateMnemonic(Control.java:2611) 	at org.eclipse.swt.widgets.Composite.translateMnemonic(Composite.java:807) 	at org.eclipse.swt.widgets.Control.translateMnemonic(Control.java:2629) 	at org.eclipse.swt.widgets.Display.translateMnemonic(Display.java:3314) 	at org.eclipse.swt.widgets.Display.filterMessage(Display.java:791) 	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2523) 	at org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:1570) 	at org.eclipse.ui.internal.Workbench.runUI(Workbench.java:1534) 	at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:306) 	at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:143) 	at org.eclipse.ui.internal.ide.IDEApplication.run(IDEApplication.java:103) 	at org.eclipse.core.internal.runtime.PlatformActivator$1.run(PlatformActivator.java:228) 	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:338) 	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:151) 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) 	at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source) 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source) 	at java.lang.reflect.Method.invoke(Unknown Source) 	at org.eclipse.core.launcher.Main.invokeFramework(Main.java:268) 	at org.eclipse.core.launcher.Main.basicRun(Main.java:260) 	at org.eclipse.core.launcher.Main.run(Main.java:887) 	at org.eclipse.core.launcher.Main.main(Main.java:871)
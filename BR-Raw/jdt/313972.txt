[projection] Java editor randomly crashes when opening certain Java files (throws IllegalStateException)

Build Identifier: I20100513-1500 (Eclipse 3.6RC1) Enviroment: * Eclipse 3.6RC1 64-bit Cacoa * Mac OS X 10.5.8 * Java 1.6.0_17-b04-248-9M3125 * Clean install: no Eclipse plugins installed, empty .metadata directory * My workspace is pretty large (10000+ files, a mix of Java, XML, etc), although I've been able to reproduce this in a workspace with only one open project containing just one Java file. Symptoms: The bug manifests randomly (race condition?) when opening Java files (see attached stack trace). The bug only applies to the Java editor, as the files open fine in the standard text editor (right-click -> Open with... -> Text Editor). To make things worse, the SAME FILE will sometimes open successfully and then crash the next time its opened. So, it looks like the contents of the file have nothing to do with the crash. It doesn't matter how the file is opened: double-click from explorer, open declaration (F3), etc. Cursory analysis: I couldn't find the same bug mentioned anywhere in Bugzilla or on the internet, so perhaps it's just me. Here are some old bugs with the same stack trace, but steps to reproduce are quite different from mine: https://bugs.eclipse.org/bugs/show_bug.cgi?id=67043 http://scala-ide.assembla.com/spaces/scala-ide/tickets/115-single-line-comment-broken-in-plugin I checked out the source code for ProjectionTextStore:152 and the root case is a apparently BadLocationException, which is unfortunately swallowed by the internalError() method :( Per the docs, BadLocationException indicates that an invalid document position is being accessed (negative? Past EOF?) Anyway, without more context or familiarity with the codebase, it will be difficult for me to track this down. Does anyone more familiar with the editor initialization code have any idea what could be causing this? Reproducible: Sometimes Steps to Reproduce: 1. Double-click on a Java file 2. Java editor crashes when opening (see attached stack trace)
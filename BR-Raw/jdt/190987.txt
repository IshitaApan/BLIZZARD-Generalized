[build path] Project can add itself as class folder

I20070601-0010 1. Create a new Project P01 2. P01>Build Path>Configure Build Path... 3. Remove 'src' source folder 4. On Library Page>Add Class Folder... 5. Add 'P01' as class folder 6. OK 7. Open Referenced library and delete 'P01' folder Is: P01 is deleted and !ENTRY org.eclipse.ltk.ui.refactoring 4 4 2007-06-05 11:24:58.659 !MESSAGE Resource '/P01/.classpath' does not exist. !STACK 1 Java Model Exception: Core Exception [code 368] Resource '/P01/.classpath' does not exist. 	at org.eclipse.jdt.internal.core.BatchOperation.executeOperation(BatchOperation.java:50) 	at org.eclipse.jdt.internal.core.JavaModelOperation.run(JavaModelOperation.java:720) 	at org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1797) 	at org.eclipse.jdt.core.JavaCore.run(JavaCore.java:4466) 	at org.eclipse.jdt.internal.corext.refactoring.changes.DynamicValidationStateChange.perform(DynamicValidationStateChange.java:101) 	at org.eclipse.ltk.core.refactoring.CompositeChange.perform(CompositeChange.java:278) 	at org.eclipse.jdt.internal.corext.refactoring.changes.DynamicValidationStateChange.access$0(DynamicValidationStateChange.java:1) 	at org.eclipse.jdt.internal.corext.refactoring.changes.DynamicValidationStateChange$1.run(DynamicValidationStateChange.java:98) 	at org.eclipse.jdt.internal.core.BatchOperation.executeOperation(BatchOperation.java:39) 	at org.eclipse.jdt.internal.core.JavaModelOperation.run(JavaModelOperation.java:720) 	at org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1797) 	at org.eclipse.jdt.core.JavaCore.run(JavaCore.java:4466) 	at org.eclipse.jdt.internal.corext.refactoring.changes.DynamicValidationStateChange.perform(DynamicValidationStateChange.java:101) 	at org.eclipse.ltk.core.refactoring.CompositeChange.perform(CompositeChange.java:278) 	at org.eclipse.ltk.core.refactoring.PerformChangeOperation$1.run(PerformChangeOperation.java:258) 	at org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1797) 	at org.eclipse.ltk.core.refactoring.PerformChangeOperation.executeChange(PerformChangeOperation.java:306) 	at org.eclipse.ltk.internal.ui.refactoring.UIPerformChangeOperation.access$1(UIPerformChangeOperation.java:1) 	at org.eclipse.ltk.internal.ui.refactoring.UIPerformChangeOperation$1.run(UIPerformChangeOperation.java:66) 	at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37) 	at org.eclipse.ltk.internal.ui.refactoring.UIPerformChangeOperation$2.run(UIPerformChangeOperation.java:84) 	at org.eclipse.swt.widgets.RunnableLock.run(RunnableLock.java:35) 	at org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:123) 	at org.eclipse.swt.widgets.Display.runAsyncMessages(Display.java:3659) 	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3296) 	at org.eclipse.jface.operation.ModalContext$ModalContextThread.block(ModalContext.java:158) 	at org.eclipse.jface.operation.ModalContext.run(ModalContext.java:326) 	at org.eclipse.ltk.internal.ui.refactoring.RefactoringWizardDialog2.run(RefactoringWizardDialog2.java:310) 	at org.eclipse.ltk.ui.refactoring.RefactoringWizard.internalPerformFinish(RefactoringWizard.java:553) 	at org.eclipse.ltk.ui.refactoring.UserInputWizardPage.performFinish(UserInputWizardPage.java:154) 	at org.eclipse.jdt.internal.ui.refactoring.reorg.DeleteWizard$DeleteInputPage.performFinish(DeleteWizard.java:177) 	at org.eclipse.ltk.ui.refactoring.RefactoringWizard.performFinish(RefactoringWizard.java:619) 	at org.eclipse.ltk.internal.ui.refactoring.RefactoringWizardDialog2.okPressed(RefactoringWizardDialog2.java:439) 	at org.eclipse.jface.dialogs.Dialog.buttonPressed(Dialog.java:464) 	at org.eclipse.jface.dialogs.Dialog$2.widgetSelected(Dialog.java:616) 	at org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:227) 	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:938) 	at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3682) 	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3293) 	at org.eclipse.jface.window.Window.runEventLoop(Window.java:820) 	at org.eclipse.jface.window.Window.open(Window.java:796) 	at org.eclipse.ltk.ui.refactoring.RefactoringWizardOpenOperation$1.run(RefactoringWizardOpenOperation.java:142) 	at org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:67) 	at org.eclipse.ltk.ui.refactoring.RefactoringWizardOpenOperation.run(RefactoringWizardOpenOperation.java:154) 	at org.eclipse.jdt.internal.ui.refactoring.actions.RefactoringStarter.activate(RefactoringStarter.java:49) 	at org.eclipse.jdt.internal.ui.refactoring.UserInterfaceStarter.activate(UserInterfaceStarter.java:60) 	at org.eclipse.jdt.internal.corext.refactoring.RefactoringExecutionStarter.startDeleteRefactoring(RefactoringExecutionStarter.java:289) 	at org.eclipse.jdt.internal.ui.refactoring.reorg.DeleteAction.run(DeleteAction.java:83) 	at org.eclipse.jdt.ui.actions.SelectionDispatchAction.dispatchRun(SelectionDispatchAction.java:268) 	at org.eclipse.jdt.ui.actions.SelectionDispatchAction.run(SelectionDispatchAction.java:244) 	at org.eclipse.jface.action.Action.runWithEvent(Action.java:498) 	at org.eclipse.ui.actions.RetargetAction.runWithEvent(RetargetAction.java:229) 	at org.eclipse.jface.commands.ActionHandler.execute(ActionHandler.java:119) 	at org.eclipse.core.commands.Command.executeWithChecks(Command.java:475) 	at org.eclipse.core.commands.ParameterizedCommand.executeWithChecks(ParameterizedCommand.java:429) 	at org.eclipse.ui.internal.handlers.HandlerService.executeCommand(HandlerService.java:165) 	at org.eclipse.ui.internal.keys.WorkbenchKeyboard.executeCommand(WorkbenchKeyboard.java:470) 	at org.eclipse.ui.internal.keys.WorkbenchKeyboard.press(WorkbenchKeyboard.java:821) 	at org.eclipse.ui.internal.keys.WorkbenchKeyboard.processKeyEvent(WorkbenchKeyboard.java:879) 	at org.eclipse.ui.internal.keys.OutOfOrderListener.handleEvent(OutOfOrderListener.java:76) 	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:938) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:962) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:947) 	at org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:975) 	at org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:971) 	at org.eclipse.swt.widgets.Widget.wmKeyDown(Widget.java:1570) 	at org.eclipse.swt.widgets.Control.WM_KEYDOWN(Control.java:3992) 	at org.eclipse.swt.widgets.Tree.WM_KEYDOWN(Tree.java:5480) 	at org.eclipse.swt.widgets.Control.windowProc(Control.java:3701) 	at org.eclipse.swt.widgets.Tree.windowProc(Tree.java:5370) 	at org.eclipse.swt.widgets.Display.windowProc(Display.java:4364) 	at org.eclipse.swt.internal.win32.OS.DispatchMessageW(Native Method) 	at org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:2264) 	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3291) 	at org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:2389) 	at org.eclipse.ui.internal.Workbench.runUI(Workbench.java:2353) 	at org.eclipse.ui.internal.Workbench.access$4(Workbench.java:2219) 	at org.eclipse.ui.internal.Workbench$4.run(Workbench.java:466) 	at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:289) 	at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:461) 	at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149) 	at org.eclipse.ui.internal.ide.application.IDEApplication.start(IDEApplication.java:106) 	at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:153) 	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:106) 	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:76) 	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:363) 	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:176) 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) 	at java.lang.reflect.Method.invoke(Method.java:585) 	at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:504) 	at org.eclipse.equinox.launcher.Main.basicRun(Main.java:443) 	at org.eclipse.equinox.launcher.Main.run(Main.java:1169) 	at org.eclipse.equinox.launcher.Main.main(Main.java:1144) Caused by: org.eclipse.core.internal.resources.ResourceException: Resource '/P01/.classpath' does not exist. 	at org.eclipse.core.internal.resources.Resource.checkExists(Resource.java:310) 	at org.eclipse.core.internal.resources.Resource.checkAccessible(Resource.java:193) 	at org.eclipse.core.internal.resources.File.getContents(File.java:285) 	at org.eclipse.core.internal.resources.File.getContents(File.java:276) 	at org.eclipse.jdt.internal.corext.refactoring.changes.DeletePackageFragmentRootChange.getFileLength(DeletePackageFragmentRootChange.java:153) 	at org.eclipse.jdt.internal.corext.refactoring.changes.DeletePackageFragmentRootChange.doDelete(DeletePackageFragmentRootChange.java:131) 	at org.eclipse.jdt.internal.corext.refactoring.changes.AbstractDeleteChange.perform(AbstractDeleteChange.java:38) 	at org.eclipse.ltk.core.refactoring.CompositeChange.perform(CompositeChange.java:278) 	at org.eclipse.jdt.internal.corext.refactoring.changes.DynamicValidationStateChange.access$0(DynamicValidationStateChange.java:1) 	at org.eclipse.jdt.internal.corext.refactoring.changes.DynamicValidationStateChange$1.run(DynamicValidationStateChange.java:98) 	at org.eclipse.jdt.internal.core.BatchOperation.executeOperation(BatchOperation.java:39) 	at org.eclipse.jdt.internal.core.JavaModelOperation.run(JavaModelOperation.java:720) 	at org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1797) 	at org.eclipse.jdt.core.JavaCore.run(JavaCore.java:4466) 	at org.eclipse.jdt.internal.corext.refactoring.changes.DynamicValidationStateChange.perform(DynamicValidationStateChange.java:101) 	at org.eclipse.ltk.core.refactoring.CompositeChange.perform(CompositeChange.java:278) 	at org.eclipse.jdt.internal.corext.refactoring.changes.DynamicValidationStateChange.access$0(DynamicValidationStateChange.java:1) 	at org.eclipse.jdt.internal.corext.refactoring.changes.DynamicValidationStateChange$1.run(DynamicValidationStateChange.java:98) 	at org.eclipse.jdt.internal.core.BatchOperation.executeOperation(BatchOperation.java:39) 	at org.eclipse.jdt.internal.core.JavaModelOperation.run(JavaModelOperation.java:720) 	at org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1797) 	at org.eclipse.jdt.core.JavaCore.run(JavaCore.java:4466) 	at org.eclipse.jdt.internal.corext.refactoring.changes.DynamicValidationStateChange.perform(DynamicValidationStateChange.java:101) 	at org.eclipse.ltk.core.refactoring.CompositeChange.perform(CompositeChange.java:278) 	at org.eclipse.ltk.core.refactoring.PerformChangeOperation$1.run(PerformChangeOperation.java:258) 	at org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1797) 	at org.eclipse.ltk.core.refactoring.PerformChangeOperation.executeChange(PerformChangeOperation.java:306) 	at org.eclipse.ltk.internal.ui.refactoring.UIPerformChangeOperation.access$1(UIPerformChangeOperation.java:1) 	at org.eclipse.ltk.internal.ui.refactoring.UIPerformChangeOperation$1.run(UIPerformChangeOperation.java:66) 	at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37) 	at org.eclipse.ltk.internal.ui.refactoring.UIPerformChangeOperation$2.run(UIPerformChangeOperation.java:84) 	at org.eclipse.swt.widgets.RunnableLock.run(RunnableLock.java:35) 	at org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:123) 	at org.eclipse.swt.widgets.Display.runAsyncMessages(Display.java:3659) 	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3296) 	at org.eclipse.jface.operation.ModalContext$ModalContextThread.block(ModalContext.java:158) 	at org.eclipse.jface.operation.ModalContext.run(ModalContext.java:326) 	at org.eclipse.ltk.internal.ui.refactoring.RefactoringWizardDialog2.run(RefactoringWizardDialog2.java:310) 	at org.eclipse.ltk.ui.refactoring.RefactoringWizard.internalPerformFinish(RefactoringWizard.java:553) 	at org.eclipse.ltk.ui.refactoring.UserInputWizardPage.performFinish(UserInputWizardPage.java:154) 	at org.eclipse.jdt.internal.ui.refactoring.reorg.DeleteWizard$DeleteInputPage.performFinish(DeleteWizard.java:177) 	at org.eclipse.ltk.ui.refactoring.RefactoringWizard.performFinish(RefactoringWizard.java:619) 	at org.eclipse.ltk.internal.ui.refactoring.RefactoringWizardDialog2.okPressed(RefactoringWizardDialog2.java:439) 	at org.eclipse.jface.dialogs.Dialog.buttonPressed(Dialog.java:464) 	at org.eclipse.jface.dialogs.Dialog$2.widgetSelected(Dialog.java:616) 	at org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:227) 	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:938) 	at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3682) 	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3293) 	at org.eclipse.jface.window.Window.runEventLoop(Window.java:820) 	at org.eclipse.jface.window.Window.open(Window.java:796) 	at org.eclipse.ltk.ui.refactoring.RefactoringWizardOpenOperation$1.run(RefactoringWizardOpenOperation.java:142) 	at org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:67) 	at org.eclipse.ltk.ui.refactoring.RefactoringWizardOpenOperation.run(RefactoringWizardOpenOperation.java:154) 	at org.eclipse.jdt.internal.ui.refactoring.actions.RefactoringStarter.activate(RefactoringStarter.java:49) 	at org.eclipse.jdt.internal.ui.refactoring.UserInterfaceStarter.activate(UserInterfaceStarter.java:60) 	at org.eclipse.jdt.internal.corext.refactoring.RefactoringExecutionStarter.startDeleteRefactoring(RefactoringExecutionStarter.java:289) 	at org.eclipse.jdt.internal.ui.refactoring.reorg.DeleteAction.run(DeleteAction.java:83) 	at org.eclipse.jdt.ui.actions.SelectionDispatchAction.dispatchRun(SelectionDispatchAction.java:268) 	at org.eclipse.jdt.ui.actions.SelectionDispatchAction.run(SelectionDispatchAction.java:244) 	at org.eclipse.jface.action.Action.runWithEvent(Action.java:498) 	at org.eclipse.ui.actions.RetargetAction.runWithEvent(RetargetAction.java:229) 	at org.eclipse.jface.commands.ActionHandler.execute(ActionHandler.java:119) 	at org.eclipse.core.commands.Command.executeWithChecks(Command.java:475) 	at org.eclipse.core.commands.ParameterizedCommand.executeWithChecks(ParameterizedCommand.java:429) 	at org.eclipse.ui.internal.handlers.HandlerService.executeCommand(HandlerService.java:165) 	at org.eclipse.ui.internal.keys.WorkbenchKeyboard.executeCommand(WorkbenchKeyboard.java:470) 	at org.eclipse.ui.internal.keys.WorkbenchKeyboard.press(WorkbenchKeyboard.java:821) 	at org.eclipse.ui.internal.keys.WorkbenchKeyboard.processKeyEvent(WorkbenchKeyboard.java:879) 	at org.eclipse.ui.internal.keys.OutOfOrderListener.handleEvent(OutOfOrderListener.java:76) 	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:938) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:962) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:947) 	at org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:975) 	at org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:971) 	at org.eclipse.swt.widgets.Widget.wmKeyDown(Widget.java:1570) 	at org.eclipse.swt.widgets.Control.WM_KEYDOWN(Control.java:3992) 	at org.eclipse.swt.widgets.Tree.WM_KEYDOWN(Tree.java:5480) 	at org.eclipse.swt.widgets.Control.windowProc(Control.java:3701) 	at org.eclipse.swt.widgets.Tree.windowProc(Tree.java:5370) 	at org.eclipse.swt.widgets.Display.windowProc(Display.java:4364) 	at org.eclipse.swt.internal.win32.OS.DispatchMessageW(Native Method) 	at org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:2264) 	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3291) 	at org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:2389) 	at org.eclipse.ui.internal.Workbench.runUI(Workbench.java:2353) 	at org.eclipse.ui.internal.Workbench.access$4(Workbench.java:2219) 	at org.eclipse.ui.internal.Workbench$4.run(Workbench.java:466) 	at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:289) 	at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:461) 	at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149) 	at org.eclipse.ui.internal.ide.application.IDEApplication.start(IDEApplication.java:106) 	at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:153) 	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:106) 	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:76) 	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:363) 	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:176) 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) 	at java.lang.reflect.Method.invoke(Method.java:585) 	at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:504) 	at org.eclipse.equinox.launcher.Main.basicRun(Main.java:443) 	at org.eclipse.equinox.launcher.Main.run(Main.java:1169) 	at org.eclipse.equinox.launcher.Main.main(Main.java:1144) !SUBENTRY 1 org.eclipse.core.resources 4 368 2007-06-05 11:24:58.659 !MESSAGE Resource '/P01/.classpath' does not exist. !SUBENTRY 1 org.eclipse.core.resources 4 368 2007-06-05 11:24:58.659 !MESSAGE Resource '/P01/.classpath' does not exist. Should: Not sure: a) Not allow to add the project as a class folder to itself b) Render the class folder in the PE such that it is clear it is the project itself (use project icon instead of source folder icon) c) Warn the user that this will delete the project d) ? I would go for a), in any case DeletePackageFragmentRootChange has to have a guard to prevent the exception. See also bug 190986
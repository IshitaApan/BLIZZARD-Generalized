[Undo] NPE in OperationHistoryActionHandler$HistoryListener when deleting multiple unsaved Java editors

Created attachment 120352 Proposed Fix I20081211-1908 - open a .java file - press Space - open another .java file - press Space - select the files in the Package Explorer - press Delete - click 'OK' (confirm delete) - click 'Continue' (confirm unsaved files warning) => NPE in log A difference to 3.5M3 is that the notification now happens in the ModalContextThread, and not in the UI thread. AFAICS, the problem is that the OperationHistoryActionHandler is already disposed when HistoryListener.historyNotification(..) gets called. java.lang.NullPointerException 	at org.eclipse.ui.operations.OperationHistoryActionHandler$HistoryListener.historyNotification(OperationHistoryActionHandler.java:123) 	at org.eclipse.core.commands.operations.DefaultOperationHistory$2.run(DefaultOperationHistory.java:939) 	at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37) 	at org.eclipse.core.commands.operations.DefaultOperationHistory.notifyListeners(DefaultOperationHistory.java:928) 	at org.eclipse.core.commands.operations.DefaultOperationHistory.notifyDone(DefaultOperationHistory.java:1002) 	at org.eclipse.core.commands.operations.DefaultOperationHistory.closeOperation(DefaultOperationHistory.java:1371) 	at org.eclipse.ltk.internal.core.refactoring.UndoManager2.changePerformed(UndoManager2.java:152) 	at org.eclipse.ltk.core.refactoring.PerformChangeOperation$1.run(PerformChangeOperation.java:267) 	at org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1800) 	at org.eclipse.ltk.core.refactoring.PerformChangeOperation.executeChange(PerformChangeOperation.java:308) 	at org.eclipse.ltk.internal.ui.refactoring.UIPerformChangeOperation.executeChange(UIPerformChangeOperation.java:92) 	at org.eclipse.ltk.core.refactoring.PerformChangeOperation.run(PerformChangeOperation.java:220) 	at org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1800) 	at org.eclipse.ltk.internal.ui.refactoring.WorkbenchRunnableAdapter.run(WorkbenchRunnableAdapter.java:87) 	at org.eclipse.jface.operation.ModalContext$ModalContextThread.run(ModalContext.java:121)
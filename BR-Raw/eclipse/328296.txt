DND of markers views causes NPE in StackRenderer

1. Start your inner with a clean workspace. 2. Click and drag the 'Problems' view outside the workbench window to detach it. 3. An NPE is thrown. Seems to always have been a problem but is now surfacing due to the new code added to support bug 328253. java.lang.NullPointerException 	at org.eclipse.e4.ui.workbench.renderers.swt.StackRenderer$1.handleEvent(StackRenderer.java:172) 	at org.eclipse.e4.ui.services.internal.events.UIEventHandler.handleEvent(UIEventHandler.java:41) 	at org.eclipse.equinox.internal.event.EventHandlerWrapper.handleEvent(EventHandlerWrapper.java:188) 	at org.eclipse.equinox.internal.event.EventHandlerTracker.dispatchEvent(EventHandlerTracker.java:197) 	at org.eclipse.equinox.internal.event.EventHandlerTracker.dispatchEvent(EventHandlerTracker.java:1) 	at org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent(EventManager.java:230) 	at org.eclipse.osgi.framework.eventmgr.ListenerQueue.dispatchEventSynchronous(ListenerQueue.java:148) 	at org.eclipse.equinox.internal.event.EventAdminImpl.dispatchEvent(EventAdminImpl.java:135) 	at org.eclipse.equinox.internal.event.EventAdminImpl.sendEvent(EventAdminImpl.java:78) 	at org.eclipse.equinox.internal.event.EventComponent.sendEvent(EventComponent.java:39) 	at org.eclipse.e4.ui.services.internal.events.EventBroker.send(EventBroker.java:73) 	at org.eclipse.e4.ui.internal.workbench.UIEventPublisher.notifyChanged(UIEventPublisher.java:58) 	at org.eclipse.emf.common.notify.impl.BasicNotifierImpl.eNotify(BasicNotifierImpl.java:380) 	at org.eclipse.e4.ui.model.application.ui.basic.impl.PartImpl.setTooltip(PartImpl.java:822) 	at org.eclipse.ui.internal.e4.compatibility.CompatibilityPart$2.propertyChanged(CompatibilityPart.java:205) 	at org.eclipse.ui.part.WorkbenchPart.firePropertyChange(WorkbenchPart.java:129) 	at org.eclipse.ui.part.WorkbenchPart.setTitleToolTip(WorkbenchPart.java:346) 	at org.eclipse.ui.internal.views.markers.ExtendedMarkersView.access$3(ExtendedMarkersView.java:1) 	at org.eclipse.ui.internal.views.markers.ExtendedMarkersView$6.partHidden(ExtendedMarkersView.java:766) 	at org.eclipse.ui.internal.WorkbenchPage.firePartHidden(WorkbenchPage.java:3145) 	at org.eclipse.ui.internal.WorkbenchPage.access$5(WorkbenchPage.java:3138) 	at org.eclipse.ui.internal.WorkbenchPage$E4PartListener.partHidden(WorkbenchPage.java:154) 	at org.eclipse.e4.ui.internal.workbench.PartServiceImpl.firePartHidden(PartServiceImpl.java:179) 	at org.eclipse.e4.ui.internal.workbench.PartServiceImpl.access$1(PartServiceImpl.java:177) 	at org.eclipse.e4.ui.internal.workbench.PartServiceImpl$1.handleEvent(PartServiceImpl.java:79) 	at org.eclipse.e4.ui.services.internal.events.UIEventHandler.handleEvent(UIEventHandler.java:41) 	at org.eclipse.equinox.internal.event.EventHandlerWrapper.handleEvent(EventHandlerWrapper.java:188) 	at org.eclipse.equinox.internal.event.EventHandlerTracker.dispatchEvent(EventHandlerTracker.java:197) 	at org.eclipse.equinox.internal.event.EventHandlerTracker.dispatchEvent(EventHandlerTracker.java:1) 	at org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent(EventManager.java:230) 	at org.eclipse.osgi.framework.eventmgr.ListenerQueue.dispatchEventSynchronous(ListenerQueue.java:148) 	at org.eclipse.equinox.internal.event.EventAdminImpl.dispatchEvent(EventAdminImpl.java:135) 	at org.eclipse.equinox.internal.event.EventAdminImpl.sendEvent(EventAdminImpl.java:78) 	at org.eclipse.equinox.internal.event.EventComponent.sendEvent(EventComponent.java:39) 	at org.eclipse.e4.ui.services.internal.events.EventBroker.send(EventBroker.java:73) 	at org.eclipse.e4.ui.internal.workbench.UIEventPublisher.notifyChanged(UIEventPublisher.java:58) 	at org.eclipse.emf.common.notify.impl.BasicNotifierImpl.eNotify(BasicNotifierImpl.java:380) 	at org.eclipse.e4.ui.model.application.ui.impl.ElementContainerImpl.setSelectedElement(ElementContainerImpl.java:159) 	at org.eclipse.e4.ui.workbench.renderers.swt.StackRenderer$3.widgetSelected(StackRenderer.java:437) 	at org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:234) 	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:84) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1053) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1077) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1062) 	at org.eclipse.swt.widgets.Widget.notifyListeners(Widget.java:774) 	at org.eclipse.e4.ui.widgets.CTabFolder.setSelection(CTabFolder.java:2830) 	at org.eclipse.e4.ui.widgets.CTabFolder.destroyItem(CTabFolder.java:519) 	at org.eclipse.e4.ui.widgets.CTabItem.dispose(CTabItem.java:126) 	at org.eclipse.e4.ui.workbench.renderers.swt.StackRenderer.hideChild(StackRenderer.java:396) 	at org.eclipse.e4.ui.internal.workbench.swt.PartRenderingEngine$4.handleEvent(PartRenderingEngine.java:255) 	at org.eclipse.e4.ui.services.internal.events.UIEventHandler.handleEvent(UIEventHandler.java:41) 	at org.eclipse.equinox.internal.event.EventHandlerWrapper.handleEvent(EventHandlerWrapper.java:188) 	at org.eclipse.equinox.internal.event.EventHandlerTracker.dispatchEvent(EventHandlerTracker.java:197) 	at org.eclipse.equinox.internal.event.EventHandlerTracker.dispatchEvent(EventHandlerTracker.java:1) 	at org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent(EventManager.java:230) 	at org.eclipse.osgi.framework.eventmgr.ListenerQueue.dispatchEventSynchronous(ListenerQueue.java:148) 	at org.eclipse.equinox.internal.event.EventAdminImpl.dispatchEvent(EventAdminImpl.java:135) 	at org.eclipse.equinox.internal.event.EventAdminImpl.sendEvent(EventAdminImpl.java:78) 	at org.eclipse.equinox.internal.event.EventComponent.sendEvent(EventComponent.java:39) 	at org.eclipse.e4.ui.services.internal.events.EventBroker.send(EventBroker.java:73) 	at org.eclipse.e4.ui.internal.workbench.UIEventPublisher.notifyChanged(UIEventPublisher.java:58) 	at org.eclipse.emf.common.notify.impl.BasicNotifierImpl.eNotify(BasicNotifierImpl.java:380) 	at org.eclipse.emf.common.notify.impl.NotificationImpl.dispatch(NotificationImpl.java:1033) 	at org.eclipse.emf.common.notify.impl.NotificationImpl.dispatch(NotificationImpl.java:1038) 	at org.eclipse.emf.common.notify.impl.NotifyingListImpl.remove(NotifyingListImpl.java:724) 	at org.eclipse.emf.common.util.AbstractEList.remove(AbstractEList.java:466) 	at org.eclipse.e4.ui.internal.workbench.ModelServiceImpl.detach(ModelServiceImpl.java:496) 	at org.eclipse.e4.ui.workbench.addons.dndaddon.DetachedDropAgent.drop(DetachedDropAgent.java:44) 	at org.eclipse.e4.ui.workbench.addons.dndaddon.DnDManager.startDrag(DnDManager.java:201) 	at org.eclipse.e4.ui.workbench.addons.dndaddon.DnDManager$3.handleEvent(DnDManager.java:112) 	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:84) 	at org.eclipse.swt.widgets.Display.filterEvent(Display.java:1253) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1052) 	at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:4083) 	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3674) 	at org.eclipse.e4.ui.internal.workbench.swt.PartRenderingEngine$6.run(PartRenderingEngine.java:772) 	at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:332) 	at org.eclipse.e4.ui.internal.workbench.swt.PartRenderingEngine.run(PartRenderingEngine.java:681)
[Viewers] Tree view is removing + indicator when one of multiple children is removed.

User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.3) Gecko/20090824 Firefox/3.5.3 Build Identifier: With the ongoing breakpoints view I experienced a case where the tree view shows no + sign for a breakpoint node although the node actually still has children. The setup: The model has a breakpoint with two children, two breakpoint instances. The breakpoint is not expanded and the children have not been requested by the view. The view shows the "+" sign to let the user expand the instances. When now one of the two instances is removed the view removes the + sign and it appears as if the breakpoint would not have any children anymore. When handling the ADD delta, the code in TreeViewer.java adds a "disassociated" children to mark that there are children: >	item.setItemCount(1); >	TreeItem child = item.getItem(0); >	if (child.getData() != null) { >		disassociate(child); >	} >	item.clear(0, true); When handling the removed breakpoint instance, the code does incorrectly remove this instance in TreeModelContentProvider.java: >if (unmappedIndex >= 0) { >	// did not find the element, but found an unmapped item. >	// remove the unmapped item in it's place and update filters >	if (DEBUG_CONTENT_PROVIDER) { >		System.out.println(" - (not found) remove(" + parentPath.getLastSegment() + ", viewIndex: " + viewIndex + " modelIndex: " + modelIndex); //$NON-NLS-1$ //$NON-NLS-2$ //$NON-NLS-3$ >	} >	modelIndex = viewToModelIndex(parentPath, unmappedIndex); >	rescheduleUpdates(parentPath, modelIndex); >	getTreeViewer().remove(parentPath, unmappedIndex); >	removeElementFromFilters(parentPath, modelIndex); >	return; >} As my current workaround is to disable the special handling. Trace of deltas: Here the model deltas: FIRE DELTA: Model Delta Start Element: org.eclipse.debug.internal.ui.elements.adapters.DefaultBreakpointManagerInput@18c548 Flags: NO_CHANGE Index: 0 Child Count: 1 Element: org.eclipse.cdt.debug.internal.core.breakpoints.CLineBreakpoint@9f77c0b3 Flags: ADDED | INSTALL | Index: 0 Child Count: 0 Model Delta End handleAdd(org.eclipse.cdt.debug.internal.core.breakpoints.CLineBreakpoint@9f77c0b3) 	BEGIN - IChildrenCountUpdate: org.eclipse.debug.internal.ui.elements.adapters.DefaultBreakpointManagerInput@18c548 setChildCount(org.eclipse.debug.internal.ui.elements.adapters.DefaultBreakpointManagerInput@18c548, modelCount: 1 viewCount: 1) 	END - IChildrenCountUpdate: org.eclipse.debug.internal.ui.elements.adapters.DefaultBreakpointManagerInput@18c548 updateElement(org.eclipse.debug.internal.ui.elements.adapters.DefaultBreakpointManagerInput@18c548, 0) > modelIndex = 0 	BEGIN - IChildrenUpdate: org.eclipse.debug.internal.ui.elements.adapters.DefaultBreakpointManagerInput@18c548 {0,1} replace(org.eclipse.debug.internal.ui.elements.adapters.DefaultBreakpointManagerInput@18c548, modelIndex: 0 viewIndex: 0, org.eclipse.cdt.debug.internal.core.breakpoints.CLineBreakpoint@9f77c0b3) LABEL SEQUENCE BEGINS 	BEGIN - ILabelUpdate: org.eclipse.cdt.debug.internal.core.breakpoints.CLineBreakpoint@9f77c0b3 updateHasChildren(org.eclipse.cdt.debug.internal.core.breakpoints.CLineBreakpoint@9f77c0b3 	BEGIN - IHasChildrenUpdate: org.eclipse.cdt.debug.internal.core.breakpoints.CLineBreakpoint@9f77c0b3 	END - IChildrenUpdate: org.eclipse.debug.internal.ui.elements.adapters.DefaultBreakpointManagerInput@18c548 {0,1} setHasChildren(org.eclipse.cdt.debug.internal.core.breakpoints.CLineBreakpoint@9f77c0b3 >> true 	END - IHasChildrenUpdate: org.eclipse.cdt.debug.internal.core.breakpoints.CLineBreakpoint@9f77c0b3 	END - ILabelUpdate: org.eclipse.cdt.debug.internal.core.breakpoints.CLineBreakpoint@9f77c0b3 LABEL SEQUENCE ENDS FIRE DELTA: Model Delta Start Element: org.eclipse.debug.internal.ui.elements.adapters.DefaultBreakpointManagerInput@18c548 Flags: NO_CHANGE Index: -1 Child Count: -1 Element: org.eclipse.cdt.debug.internal.core.breakpoints.CLineBreakpoint@9f77c0b3 Flags: STATE | Index: -1 Child Count: -1 Model Delta End LABEL SEQUENCE BEGINS 	BEGIN - ILabelUpdate: org.eclipse.cdt.debug.internal.core.breakpoints.CLineBreakpoint@9f77c0b3 FIRE DELTA: Model Delta Start Element: org.eclipse.cdt.debug.internal.core.breakpoints.CLineBreakpoint@9f77c0b3 Flags: NO_CHANGE Index: -1 Child Count: -1 Element: org.eclipse.cdt.debug.internal.core.CBreakpointInstance@12d863d Flags: REMOVED | Index: -1 Child Count: -1 Model Delta End handleRemove(org.eclipse.cdt.debug.internal.core.CBreakpointInstance@12d863d) - (not found) remove(org.eclipse.cdt.debug.internal.core.breakpoints.CLineBreakpoint@9f77c0b3, viewIndex: -1 modelIndex: -1 	END - ILabelUpdate: org.eclipse.cdt.debug.internal.core.breakpoints.CLineBreakpoint@9f77c0b3 LABEL SEQUENCE ENDS FIRE DELTA: Model Delta Start Element: org.eclipse.debug.internal.ui.elements.adapters.DefaultBreakpointManagerInput@18c548 Flags: NO_CHANGE Index: -1 Child Count: -1 Element: org.eclipse.cdt.debug.internal.core.breakpoints.CLineBreakpoint@9f77c0b3 Flags: STATE | Index: -1 Child Count: -1 Model Delta End LABEL SEQUENCE BEGINS 	BEGIN - ILabelUpdate: org.eclipse.cdt.debug.internal.core.breakpoints.CLineBreakpoint@9f77c0b3 	END - ILabelUpdate: org.eclipse.cdt.debug.internal.core.breakpoints.CLineBreakpoint@9f77c0b3 LABEL SEQUENCE ENDS Reproducible: Always
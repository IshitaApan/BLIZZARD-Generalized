[Contributions] visible/enabled: Object contributions contributed to submenus do not show up

Object contributions with menubarpath pointing to a contributed menu, such as the first example at http://publib.boulder.ibm.com/infocenter/wsphelp/index.jsp?topic=/org.eclipse.platform.doc.isv/reference/extension-points/org_eclipse_ui_popupMenus.html do not work with Eclipse 3.2M4. What happens is when findMenuUsingPath is called, it finds the menu and wraps it using SubMenuManager.wrapMenu() which calls setVisible(isVisible()) on it. Unfortunately SubMenuManager.isVisible() calls getParentMenuManager().isVisible() which turns out to be MenuManager.isVisible() which only returns true if it has at least 1 visible child. If the MenuManager doesn't have any children yet (since we are in the first pass of ObjectActionContributionManager.contributeObjectActions, as in my case) it will return false and thus the wrapper will forever have its visibile field set to false. Here's the stack trace leading up to it: Thread [main] (Suspended (breakpoint at line 405 in SubMenuManager)) 	SubMenuManager.wrapMenu(IMenuManager) line: 405 	SubMenuManager.getWrapper(IMenuManager) line: 263 	SubMenuManager.find(String) line: 179 	SubMenuManager.findUsingPath(String) line: 216 	SubMenuManager.findMenuUsingPath(String) line: 193 	ObjectActionContributor$ObjectContribution(PluginActionBuilder$BasicContribution).contributeMenu(IConfigurationElement, IMenuManager, boolean) line: 299 	ObjectActionContributor.contributeObjectMenus(IMenuManager, ISelectionProvider) line: 166 	ObjectActionContributorManager.contributeObjectActions(IWorkbenchPart, IMenuManager, ISelectionProvider) line: 80 	PopupMenuExtender.addObjectActions(IMenuManager) line: 250 	PopupMenuExtender.menuAboutToShow(IMenuManager) line: 302 	MenuManager.fireAboutToShow(IMenuManager) line: 285 	MenuManager.handleAboutToShow() line: 372 	MenuManager.access$0(MenuManager) line: 369 	MenuManager$2.menuShown(MenuEvent) line: 386 	TypedListener.handleEvent(Event) line: 117 	EventTable.sendEvent(Event) line: 66 	Menu(Widget).sendEvent(Event) line: 914 	Menu(Widget).sendEvent(int, Event, boolean) line: 938 	Menu(Widget).sendEvent(int) line: 919 	Shell(Control).WM_INITMENUPOPUP(int, int) line: 3521 	Shell(Control).windowProc(int, int, int, int) line: 3238 	Shell(Decorations).windowProc(int, int, int, int) line: 1538 	Display.windowProc(int, int, int, int) line: 3963 	OS.TrackPopupMenu(int, int, int, int, int, int, RECT) line: not available [native method] 	Menu._setVisible(boolean) line: 225 	Display.runPopups() line: 3311 	Display.readAndDispatch() line: 2899 	Workbench.runEventLoop(Window$IExceptionHandler, Display) line: 1762 	Workbench.runUI() line: 1726 	Workbench.createAndRunWorkbench(Display, WorkbenchAdvisor) line: 397 	PlatformUI.createAndRunWorkbench(Display, WorkbenchAdvisor) line: 143 	IDEApplication.run(Object) line: 106 	PlatformActivator$1.run(Object) line: 109 	EclipseAppLauncher.runApplication(Object) line: 92 	EclipseAppLauncher.start(Object) line: 68 	EclipseStarter.run(Object) line: 379 	EclipseStarter.run(String[], Runnable) line: 177 	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method] 	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 85 	NativeMethodAccessorImpl.invoke(Method, Object, Object[]) line: 58 	DelegatingMethodAccessorImpl.invoke(Method, Object, Object[]) line: 60 	Method.invoke(Object, Object[]) line: 391 	Main.invokeFramework(String[], URL[]) line: 338 	Main.basicRun(String[]) line: 282 	Main.run(String[]) line: 977 	Main.main(String[]) line: 952
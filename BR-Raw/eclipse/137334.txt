[PerspectiveBar] Order of perspective bar items not maintained across sessions when coolbar not shown

3.2 RC1 In bug 84226 comment 44, Dominique reports that: "The order of the perspectives is correctly displayed at first launch but not on the next launches if another perspective than the first one is selected. If you select another perspective, it will be this one which will appear first. Example: Say you have perspective 1,2 and 3 in this order. On first launch I have perspective 1,2,3 correctly displayed in this order. I select perspective 2 and quit the application. Next time I launch I will have the perspectives displayed in this order 2,1,3" I had been unable to reproduce the problem in the SDK. It apparently only occurs when the coolbar is not showing, e.g. if the window advisor does: IWorkbenchWindowConfigurer.setShowCoolBar(false). What is happening is that in PerspectiveSwitcher.updatePerspectiveBar() (which is called during WorkbenchWindow.open(), after the window's state has been restored), it tries to ensure that the item for the active perspective is visible. It checks that the bounds of the ToolItem are within the bounds of the ToolBar. At this point in time, however, the ToolBar's width is 0, so it repositions the item at the beginning of the toolbar. At the end of WorkbenchWindow.open(), after the call to updatePerspectiveBar(), it currently does a getShell().layout() to ensure that the trim items are layed out correctly. If an additional getShell().layout() is done before updatePerspectiveBar(), e.g. immediately after the super.open(), it fixes this problem. Doing a getShell().layout() before the super.open() does not fix the problem.
[Compatibility] Incorrect relative stack extensions in a perspective do not get rendered

Ran into this while testing one of my RCPs (https://github.com/ifedorenko/p2-browser) with recently released eclipse sdk 4.2M2. Launching the RCP directly from workbench results in "Internal Error" popup and exception below in the log. !ENTRY org.eclipse.e4.ui.workbench 4 0 2011-09-26 17:42:05.165 !MESSAGE Internal Error !STACK 0 org.eclipse.e4.core.di.InjectionException: java.lang.NullPointerException 	at org.eclipse.e4.core.internal.di.MethodRequestor.execute(MethodRequestor.java:63) 	at org.eclipse.e4.core.internal.di.InjectorImpl.processAnnotated(InjectorImpl.java:838) 	at org.eclipse.e4.core.internal.di.InjectorImpl.inject(InjectorImpl.java:110) 	at org.eclipse.e4.core.internal.di.InjectorImpl.inject(InjectorImpl.java:80) 	at org.eclipse.e4.core.contexts.ContextInjectionFactory.inject(ContextInjectionFactory.java:72) 	at org.eclipse.ui.internal.Workbench.createWorkbenchWindow(Workbench.java:1207) 	at org.eclipse.ui.internal.Workbench.getActiveWorkbenchWindow(Workbench.java:1181) 	at org.eclipse.ui.internal.services.WorkbenchSourceProvider.updateActiveShell(WorkbenchSourceProvider.java:932) 	at org.eclipse.ui.internal.services.WorkbenchSourceProvider.getCurrentState(WorkbenchSourceProvider.java:133) 	at org.eclipse.ui.internal.services.WorkbenchSourceProvider$6.handleEvent(WorkbenchSourceProvider.java:692) 	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:84) 	at org.eclipse.swt.widgets.Display.filterEvent(Display.java:1069) 	at org.eclipse.swt.widgets.Display.sendEvent(Display.java:4127) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1457) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1480) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1461) 	at org.eclipse.swt.widgets.Shell.windowDidBecomeKey(Shell.java:2102) 	at org.eclipse.swt.widgets.Display.windowProc(Display.java:5519) 	at org.eclipse.swt.internal.cocoa.OS.objc_msgSendSuper(Native Method) 	at org.eclipse.swt.widgets.Widget.callSuper(Widget.java:213) 	at org.eclipse.swt.widgets.Widget.becomeKeyWindow(Widget.java:361) 	at org.eclipse.swt.widgets.Shell.becomeKeyWindow(Shell.java:533) 	at org.eclipse.swt.widgets.Display.windowProc(Display.java:5343) 	at org.eclipse.swt.internal.cocoa.OS.objc_msgSendSuper(Native Method) 	at org.eclipse.swt.widgets.Display.applicationSendEvent(Display.java:4989) 	at org.eclipse.swt.widgets.Display.applicationProc(Display.java:5138) 	at org.eclipse.swt.internal.cocoa.OS.objc_msgSend(Native Method) 	at org.eclipse.swt.internal.cocoa.NSApplication.sendEvent(NSApplication.java:128) 	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3610) 	at org.eclipse.e4.ui.internal.workbench.swt.PartRenderingEngine$9.run(PartRenderingEngine.java:970) 	at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:332) 	at org.eclipse.e4.ui.internal.workbench.swt.PartRenderingEngine.run(PartRenderingEngine.java:886) 	at org.eclipse.e4.ui.internal.workbench.E4Workbench.createAndRunUI(E4Workbench.java:90) 	at org.eclipse.ui.internal.Workbench$3.run(Workbench.java:559) 	at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:332) 	at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:519) 	at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149) 	at com.ifedorenko.p2browser.Application.start(Application.java:31) 	at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:196) 	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:110) 	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:79) 	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:344) 	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:179) 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) 	at java.lang.reflect.Method.invoke(Method.java:597) 	at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:624) 	at org.eclipse.equinox.launcher.Main.basicRun(Main.java:579) 	at org.eclipse.equinox.launcher.Main.run(Main.java:1431) 	at org.eclipse.equinox.launcher.Main.main(Main.java:1407) Caused by: java.lang.NullPointerException 	at org.eclipse.ui.internal.WorkbenchPage.setPerspective(WorkbenchPage.java:3233) 	at org.eclipse.ui.internal.WorkbenchWindow.setup(WorkbenchWindow.java:519) 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) 	at java.lang.reflect.Method.invoke(Method.java:597) 	at org.eclipse.e4.core.internal.di.MethodRequestor.execute(MethodRequestor.java:56) 	... 50 more
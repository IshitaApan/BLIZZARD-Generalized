AbstractEList$BasicIndexOutOfBoundsException when opening a context menu

Created attachment 224320 MenuManagerRenderer patch v1 We have a view with two context menu registrations with the same tree viewer but different selection providers (don't ask me why). On the second notification to the MenuManager's listeners (it has 2, both from PopupMenuExtender), the exception below gets thrown. I have attached a patch that fixes the problem though it's not clear to me if this is the right fix. I did not alter the code that affects menu manager because that doesn't cause problems on our end. If this is the right fix, perhaps the same fix should be applied for the code that affects menu managers? org.eclipse.emf.common.util.AbstractEList$BasicIndexOutOfBoundsException: index=26, size=22 	at org.eclipse.emf.common.util.AbstractEList.add(AbstractEList.java:332) 	at org.eclipse.e4.ui.workbench.renderers.swt.MenuManagerRenderer.reconcileManagerToModel(MenuManagerRenderer.java:894) 	at org.eclipse.ui.internal.PopupMenuExtender.addMenuContributions(PopupMenuExtender.java:405) 	at org.eclipse.ui.internal.PopupMenuExtender.menuAboutToShow(PopupMenuExtender.java:379) 	at org.eclipse.jface.action.MenuManager.fireAboutToShow(MenuManager.java:343) 	at org.eclipse.jface.action.MenuManager.handleAboutToShow(MenuManager.java:475) 	at org.eclipse.jface.action.MenuManager.access$1(MenuManager.java:470) 	at org.eclipse.jface.action.MenuManager$2.menuShown(MenuManager.java:500) 	at org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:255) 	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:84) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1053) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1077) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1058) 	at org.eclipse.swt.widgets.Control.WM_INITMENUPOPUP(Control.java:4881) 	at org.eclipse.swt.widgets.Control.windowProc(Control.java:4557) 	at org.eclipse.swt.widgets.Canvas.windowProc(Canvas.java:340) 	at org.eclipse.swt.widgets.Decorations.windowProc(Decorations.java:1627) 	at org.eclipse.swt.widgets.Shell.windowProc(Shell.java:2069) 	at org.eclipse.swt.widgets.Display.windowProc(Display.java:4976) 	at org.eclipse.swt.internal.win32.OS.TrackPopupMenu(Native Method) 	at org.eclipse.swt.widgets.Menu._setVisible(Menu.java:257) 	at org.eclipse.swt.widgets.Display.runPopups(Display.java:4210) 	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3752) 	at org.eclipse.e4.ui.internal.workbench.swt.PartRenderingEngine$9.run(PartRenderingEngine.java:1021)
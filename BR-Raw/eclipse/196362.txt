[Themes] Incorrect use of IThemeRegistry.HierarchyComparator in ThemeElementHelper.addDefaulted(...)

+++ This bug was initially created as a clone of Bug #195405 +++ Build ID: 3.22M20070119 Steps To Reproduce: org.eclipse.ui.internal.themes.IThemeRegistry.HierarchyComparator uses Arrays.binarySearch(...) on the array that is being sorted at the moment. Hence Arrays.binarySearch(...) returns incorrect result. This leads to theme definitions (colors, fonts) contain incorrect values. Let me illustrate this with color example. ThemeElementHelper.addDefaulted( IHierarchalThemeElementDefinition[] definitions, IHierarchalThemeElementDefinition[] allDefs) { .... Arrays.sort(allDefs, new IThemeRegistry.HierarchyComparator(allDefs)); we sort allDefs, while the allDefs is used by HierarchyComparator for Arrays.binarySearch(..): HierarchyComparator.getDefaultsTo(String id) { .... int idx = Arrays.binarySearch(definitions, id, ID_COMPARATOR); // definitions is reference to allDefs (it is not a copy), so definitions sorting is being broken. More information: Full class names: org.eclipse.ui.internal.themes.ThemeElementHelper org.eclipse.ui.internal.themes.IThemeRegistry.HierarchyComparator
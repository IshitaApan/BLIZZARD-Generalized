intermittent problems with context menu visibility etc.

Created attachment 213397 plugin.xml entries This bug occurs when we execute on top of Eclipse SDK 4.2 M6; but it does not occur when we execute on top of Eclipse SDK 3.8 M6. Also, this bug occurs when the active editor is an XML editor (o.e.wst.xml.ui.internal.tabletree.XMLMultipageEditorPart); but it does not occur when the active editor is a Java source code editor. In Dali we have a view called the JPA Structure View. This view is much like an Outline view in that it has a tree of objects (PersistentTypes and PersistentAttributes) that correspond to the currently edited file (either an XML file or a Java file). We keep the tree's selection in sync with the position of the cursor in the active editor. If I move the cursor around in the editor (either with the mouse or the cursor keys), the selection in the JPA Structure View updates without a problem. Many times (but not all the time), if I then right-click on the currently selected item in the JPA Structure View's tree, the incorrect context menu will appear. In particular, if I move the cursor from the text representing a PersistentType to the text representing a PersistentAttribute, the JPA Structure View's tree selection changes from the appropriate PersistentType to the appropriate PersistentAttribute; but if I then right-click on the PersistentAttribute in the tree, the context menu for a PersistentType appears. (And vice-versa.) Sometimes the items in the menu will be disabled; sometimes not. If a menu item is not disabled and I activate it, a ClassCastException will occur in the handler because the handler is passed an appropriate selection. In the example above: The (incorrect) PersistentType context menu activates the PersistentType handler; but that handler throws a ClassCastException when a PersistentAttribute is returned from the IStructuredSelection returned from a call to HandlerUtil.getCurrentSelectionChecked(executionEvent). What is going on here? Where should I look to investigate this further? Attached are the entries from our plugin.xml that define the context menus and handlers for the JPA Structure View.
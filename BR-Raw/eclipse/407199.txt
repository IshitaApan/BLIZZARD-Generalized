CCE when assigning a different key binding to a command

4.3.0.I20130502-0800 - open Keys preference page (be patient: "Ctrl+Shift+L, Ctrl+Shift+L" is slow) - change the key binding of a command that already has a shortcut (e.g. change "Activate Editor" to Shift+F12) => Exception below. Code is from bug 371510. !ENTRY org.eclipse.equinox.event 4 0 2013-05-03 20:52:36.711 !MESSAGE Exception while dispatching event org.osgi.service.event.Event [topic=org/eclipse/e4/ui/model/application/ApplicationElement/tags/ADD] to handler org.eclipse.e4.ui.services.internal.events.UIEventHandler@e278e1 !STACK 0 java.lang.ClassCastException: org.eclipse.e4.ui.model.application.commands.impl.KeyBindingImpl cannot be cast to org.eclipse.e4.ui.model.application.ui.MUIElement 	at org.eclipse.e4.ui.workbench.renderers.swt.StackRenderer$TabStateHandler.handleEvent(StackRenderer.java:1585) 	at org.eclipse.e4.ui.services.internal.events.UIEventHandler$1.run(UIEventHandler.java:41) 	at org.eclipse.swt.widgets.Synchronizer.syncExec(Synchronizer.java:180) 	at org.eclipse.ui.internal.UISynchronizer.syncExec(UISynchronizer.java:150) 	at org.eclipse.swt.widgets.Display.syncExec(Display.java:4688) 	at org.eclipse.e4.ui.internal.workbench.swt.E4Application$1.syncExec(E4Application.java:205) 	at org.eclipse.e4.ui.services.internal.events.UIEventHandler.handleEvent(UIEventHandler.java:38) 	at org.eclipse.equinox.internal.event.EventHandlerWrapper.handleEvent(EventHandlerWrapper.java:197) 	at org.eclipse.equinox.internal.event.EventHandlerTracker.dispatchEvent(EventHandlerTracker.java:197) 	at org.eclipse.equinox.internal.event.EventHandlerTracker.dispatchEvent(EventHandlerTracker.java:1) 	at org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent(EventManager.java:230) 	at org.eclipse.osgi.framework.eventmgr.ListenerQueue.dispatchEventSynchronous(ListenerQueue.java:148) 	at org.eclipse.equinox.internal.event.EventAdminImpl.dispatchEvent(EventAdminImpl.java:135) 	at org.eclipse.equinox.internal.event.EventAdminImpl.sendEvent(EventAdminImpl.java:78) 	at org.eclipse.equinox.internal.event.EventComponent.sendEvent(EventComponent.java:39) 	at org.eclipse.e4.ui.services.internal.events.EventBroker.send(EventBroker.java:80) 	at org.eclipse.e4.ui.internal.workbench.UIEventPublisher.notifyChanged(UIEventPublisher.java:58) 	at org.eclipse.emf.common.notify.impl.BasicNotifierImpl.eNotify(BasicNotifierImpl.java:374) 	at org.eclipse.emf.ecore.util.EcoreEList.dispatchNotification(EcoreEList.java:249) 	at org.eclipse.emf.common.notify.impl.NotifyingListImpl.addUnique(NotifyingListImpl.java:304) 	at org.eclipse.emf.common.util.AbstractEList.add(AbstractEList.java:301) 	at org.eclipse.ui.internal.keys.BindingService.persistToModel(BindingService.java:439) 	at org.eclipse.ui.internal.keys.BindingService.access$1(BindingService.java:405) 	at org.eclipse.ui.internal.keys.BindingService$1.reRead(BindingService.java:116) 	at org.eclipse.ui.internal.keys.BindingPersistence.read(BindingPersistence.java:1287) 	at org.eclipse.ui.internal.services.PreferencePersistence$1.propertyChange(PreferencePersistence.java:436) 	at org.eclipse.ui.preferences.ScopedPreferenceStore$3.run(ScopedPreferenceStore.java:375) 	at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:42) 	at org.eclipse.ui.preferences.ScopedPreferenceStore.firePropertyChangeEvent(ScopedPreferenceStore.java:372) 	at org.eclipse.ui.preferences.ScopedPreferenceStore$2.preferenceChange(ScopedPreferenceStore.java:194) 	at org.eclipse.core.internal.preferences.EclipsePreferences$3.run(EclipsePreferences.java:896) 	at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:42) 	at org.eclipse.core.internal.preferences.EclipsePreferences.firePreferenceEvent(EclipsePreferences.java:899) 	at org.eclipse.core.internal.preferences.EclipsePreferences.put(EclipsePreferences.java:912) 	at org.eclipse.ui.preferences.ScopedPreferenceStore.setValue(ScopedPreferenceStore.java:789) 	at org.eclipse.ui.internal.keys.BindingPersistence.write(BindingPersistence.java:1107) 	at org.eclipse.ui.internal.keys.BindingService.saveLegacyPreferences(BindingService.java:383) 	at org.eclipse.ui.internal.keys.BindingService.savePreferences(BindingService.java:401) 	at org.eclipse.ui.internal.keys.model.KeyController.saveBindings(KeyController.java:427) 	at org.eclipse.ui.internal.keys.NewKeysPreferencePage.performOk(NewKeysPreferencePage.java:1272) 	at org.eclipse.jface.preference.PreferenceDialog$13.run(PreferenceDialog.java:965) 	at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:42) 	at org.eclipse.ui.internal.JFaceUtil$1.run(JFaceUtil.java:49) 	at org.eclipse.jface.util.SafeRunnable.run(SafeRunnable.java:175) 	at org.eclipse.jface.preference.PreferenceDialog.okPressed(PreferenceDialog.java:945) 	at org.eclipse.ui.internal.dialogs.FilteredPreferenceDialog.okPressed(FilteredPreferenceDialog.java:448) 	at org.eclipse.ui.internal.dialogs.WorkbenchPreferenceDialog.okPressed(WorkbenchPreferenceDialog.java:171) 	at org.eclipse.jface.preference.PreferenceDialog.buttonPressed(PreferenceDialog.java:233) 	at org.eclipse.jface.dialogs.Dialog$2.widgetSelected(Dialog.java:628) 	at org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:248) 	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:84) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1057) 	at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:4170) 	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3759) 	at org.eclipse.jface.window.Window.runEventLoop(Window.java:826) 	at org.eclipse.jface.window.Window.open(Window.java:802) 	at org.eclipse.ui.internal.dialogs.WorkbenchPreferenceDialog.open(WorkbenchPreferenceDialog.java:215) 	at org.eclipse.ui.internal.keys.GlobalKeyAssistDialog.openPreferencePage(GlobalKeyAssistDialog.java:126) 	at org.eclipse.ui.internal.keys.GlobalKeyAssistDialog.open(GlobalKeyAssistDialog.java:71) 	at org.eclipse.ui.internal.keys.BindingService.openKeyAssistDialog(BindingService.java:368) 	at org.eclipse.ui.internal.handlers.ShowKeyAssistHandler.execute(ShowKeyAssistHandler.java:37) 	at org.eclipse.ui.internal.handlers.HandlerProxy.execute(HandlerProxy.java:290) 	at org.eclipse.ui.internal.handlers.E4HandlerProxy.execute(E4HandlerProxy.java:85) 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) 	at java.lang.reflect.Method.invoke(Method.java:601) 	at org.eclipse.e4.core.internal.di.MethodRequestor.execute(MethodRequestor.java:56) 	at org.eclipse.e4.core.internal.di.InjectorImpl.invokeUsingClass(InjectorImpl.java:231) 	at org.eclipse.e4.core.internal.di.InjectorImpl.invoke(InjectorImpl.java:212) 	at org.eclipse.e4.core.contexts.ContextInjectionFactory.invoke(ContextInjectionFactory.java:132) 	at org.eclipse.e4.core.commands.internal.HandlerServiceHandler.execute(HandlerServiceHandler.java:165) 	at org.eclipse.core.commands.Command.executeWithChecks(Command.java:499) 	at org.eclipse.core.commands.ParameterizedCommand.executeWithChecks(ParameterizedCommand.java:508) 	at org.eclipse.e4.core.commands.internal.HandlerServiceImpl.executeHandler(HandlerServiceImpl.java:213) 	at org.eclipse.e4.ui.bindings.keys.KeyBindingDispatcher.executeCommand(KeyBindingDispatcher.java:277) 	at org.eclipse.e4.ui.bindings.keys.KeyBindingDispatcher.press(KeyBindingDispatcher.java:496) 	at org.eclipse.e4.ui.bindings.keys.KeyBindingDispatcher.processKeyEvent(KeyBindingDispatcher.java:547) 	at org.eclipse.e4.ui.bindings.keys.KeyBindingDispatcher.filterKeySequenceBindings(KeyBindingDispatcher.java:368) 	at org.eclipse.e4.ui.bindings.keys.KeyBindingDispatcher.access$0(KeyBindingDispatcher.java:314) 	at org.eclipse.e4.ui.bindings.keys.KeyBindingDispatcher$KeyDownFilter.handleEvent(KeyBindingDispatcher.java:83) 	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:84) 	at org.eclipse.swt.widgets.Display.filterEvent(Display.java:1262) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1056) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1081) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1066) 	at org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:1108) 	at org.eclipse.swt.widgets.Widget.sendKeyEvent(Widget.java:1104) 	at org.eclipse.swt.widgets.Widget.wmChar(Widget.java:1525) 	at org.eclipse.swt.widgets.Control.WM_CHAR(Control.java:4723) 	at org.eclipse.swt.widgets.Table.WM_CHAR(Table.java:5923) 	at org.eclipse.swt.widgets.Control.windowProc(Control.java:4611) 	at org.eclipse.swt.widgets.Table.windowProc(Table.java:5919) 	at org.eclipse.swt.widgets.Display.windowProc(Display.java:4990) 	at org.eclipse.swt.internal.win32.OS.$$YJP$$DispatchMessageW(Native Method) 	at org.eclipse.swt.internal.win32.OS.DispatchMessageW(OS.java) 	at org.eclipse.swt.internal.win32.OS.DispatchMessage(OS.java:2549) 	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3757) 	at org.eclipse.e4.ui.internal.workbench.swt.PartRenderingEngine$9.run(PartRenderingEngine.java:1109) 	at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:332) 	at org.eclipse.e4.ui.internal.workbench.swt.PartRenderingEngine.run(PartRenderingEngine.java:993) 	at org.eclipse.e4.ui.internal.workbench.E4Workbench.createAndRunUI(E4Workbench.java:138) 	at org.eclipse.ui.internal.Workbench$5.run(Workbench.java:610) 	at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:332) 	at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:567) 	at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:150) 	at org.eclipse.ui.internal.ide.application.IDEApplication.start(IDEApplication.java:124) 	at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:196) 	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:110) 	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:79) 	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:354) 	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:181) 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) 	at java.lang.reflect.Method.invoke(Method.java:601) 	at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:636) 	at org.eclipse.equinox.launcher.Main.basicRun(Main.java:591) 	at org.eclipse.equinox.launcher.Main.run(Main.java:1450) 	at org.eclipse.equinox.launcher.Main.main(Main.java:1426)
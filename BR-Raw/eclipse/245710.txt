[Workbench] Eclipse process continues to run in background after shutdown

+++ This bug was initially created as a clone of Bug #202819 +++ Build ID: I20070625-1500 Ok, I've not been able to reproduce this bug always. Usually it just happens after having Eclipse open for quite some time (1-2 days), and as I use many plugins I don't know which plugin could be actually making this happen... I've been able to see it in a debug session (some details at: http://pydev.blogspot.com/2007/09/debugging-eclipse.html) but couldn't get to the actual point of the bug (but got close to it). Still, I can explain the bug and a theoretical resolution... What I know is that the problem appears to be that in org.eclipse.ui.internal.Workbench the method busyClose(final boolean force) calls a shutdown() after the UI is disposed and clients may raise exceptions within that call (this had happened to me previously within a fixed bug in pydev at: https://bugs.eclipse.org/bugs/show_bug.cgi?id=186890). When debugging I couldn't see what was the exact line within the shutdown() method that had thrown an exception, but it was before calling the stop() method in plugins... and as the shutdown() had an exception, the runEventLoop = false; was never actually called and the process was kept alive. Also, this exception wasn't printed to anywhere (I don't know why it doesn't appear in my .log, but I guess it may be related to which services were already finished or not). So, this could be (probably is) a defective plugin I have installed, but I think that the platform should be able to shut down 'gracefully' even if a client throws some exception at that point... What's more annoying in this is that the UI closes but the plugins don't have their stop() called, so, my perspectives are set to something that happened a long time ago.
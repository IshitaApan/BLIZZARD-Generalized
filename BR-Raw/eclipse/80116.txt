[DynamicUI] AbstractWorkingSetManager tries to get namespace for bundles with no symbolic name

In AbstractWorkingSetManager#bundleChanged there is a call to getDescriptorsForNamespace that passes the symbolic name of the changed bundle. OSGi bundles are not required to have symbolic names, in which cash Bundle#getSymbolicName() will return null. This is causing an NPE in the call to getDescriptorsForNameSpace(). Here is the code: public synchronized void bundleChanged(BundleEvent event) { 	if (event.getType() != BundleEvent.STARTED) 		return; 	WorkingSetDescriptor[] descriptors= WorkbenchPlugin.getDefault() 	.getWorkingSetRegistry().getDescriptorsForNamespace(event.getBundle ().getSymbolicName()); 	for (int i= 0; i < descriptors.length; i++) { 		WorkingSetDescriptor descriptor= descriptors[i]; 		List workingSets= getWorkingSetsForId(descriptor.getId()); 		if (workingSets.size() == 0) 			continue; 		IWorkingSetUpdater updater= getUpdater(descriptor); 		for (Iterator iter= workingSets.iterator(); iter.hasNext();) { 			IWorkingSet workingSet= (IWorkingSet)iter.next(); 			if (!updater.contains(workingSet)) 				updater.add(workingSet); 		} 	} } One possible fix is the following (not tested): public synchronized void bundleChanged(BundleEvent event) { 	if (event.getType() != BundleEvent.STARTED) 		return; >>	if (event.getBundle().getSymbolicName() == null) >>		return; 	WorkingSetDescriptor[] descriptors= WorkbenchPlugin.getDefault() 	.getWorkingSetRegistry().getDescriptorsForNamespace(event.getBundle ().getSymbolicName()); 	for (int i= 0; i < descriptors.length; i++) { 		WorkingSetDescriptor descriptor= descriptors[i]; 		List workingSets= getWorkingSetsForId(descriptor.getId()); 		if (workingSets.size() == 0) 			continue; 		IWorkingSetUpdater updater= getUpdater(descriptor); 		for (Iterator iter= workingSets.iterator(); iter.hasNext();) { 			IWorkingSet workingSet= (IWorkingSet)iter.next(); 			if (!updater.contains(workingSet)) 				updater.add(workingSet); 		} 	} } Here is the log entry with the NPE: !ENTRY org.eclipse.osgi 2004-12-03 09:46:13.245 !MESSAGE An unexpected runtime error has occurred. !STACK 0 java.lang.NullPointerException 	at org.eclipse.ui.internal.registry.WorkingSetRegistry.getDescriptorsForNamespace (WorkingSetRegistry.java:124) 	at org.eclipse.ui.internal.AbstractWorkingSetManager.bundleChanged (AbstractWorkingSetManager.java:462) 	at org.eclipse.osgi.framework.internal.core.BundleContextImpl.dispatchEvent (BundleContextImpl.java:1151) 	at org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent (EventManager.java:186) 	at org.eclipse.osgi.framework.eventmgr.EventThread.run (EventThread.java:104)
[Progress] "Widget is disposed" when setting builders twice during build

Build ID: HEAD as of 4/27/2007 A user who adds an external tool builder on the BuilderPropertyPage, changes his/her mind, and impatiently tries to remove it twice while it is still running gets a "Widget is disposed" exception. Steps To Reproduce: 1. Start Eclipse on a new workspace. 2. Create a new project "foo". 3. Right-click "foo" -> Properties. Select the Builders page. 4. Create an external tool builder with the command "/bin/sleep 30" (or equivalent on non-Unix). 5. Press OK to save the properties; the new builder starts running. 6. Once again, right-click "foo" -> Properties. Select the Builders page. 7. Select the external tool builder, press Remove, and press OK. The OK button becomes disabled but the dialog doesn't close. 8. Wait a few seconds. The Cancel button becomes focused. 9. Switch to another property page (e.g., Resource); the OK button becomes enabled again. Then switch back to Builders. 10. Click OK. A "User Operation is Waiting" dialog appears showing "Setting project description." (i.e., removal of the builder) waiting on "Building workspace". 11. When the builder finishes, the exception is written to the log. Exception: Unhandled event loop exception during blocked modal context. org.eclipse.swt.SWTException: Failed to execute runnable (org.eclipse.swt.SWTException: Widget is disposed) 	at org.eclipse.swt.SWT.error(SWT.java:3547) 	at org.eclipse.swt.SWT.error(SWT.java:3465) 	at org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:126) 	at org.eclipse.swt.widgets.Display.runAsyncMessages(Display.java:3297) 	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2975) 	at org.eclipse.jface.operation.ModalContext$ModalContextThread.block(ModalContext.java:158) 	at org.eclipse.jface.operation.ModalContext.run(ModalContext.java:326) 	at org.eclipse.jface.dialogs.ProgressMonitorDialog.run(ProgressMonitorDialog.java:495) 	at org.eclipse.ui.internal.progress.ProgressMonitorJobsDialog.run(ProgressMonitorJobsDialog.java:268) 	at org.eclipse.ui.internal.progress.ProgressManager$3.run(ProgressManager.java:907) 	at org.eclipse.swt.custom.BusyIndicator.showWhile(BusyIndicator.java:67) 	at org.eclipse.ui.internal.progress.ProgressManager.busyCursorWhile(ProgressManager.java:942) 	at org.eclipse.ui.internal.progress.ProgressManager.busyCursorWhile(ProgressManager.java:917) 	at org.eclipse.ui.externaltools.internal.ui.BuilderPropertyPage.performOk(BuilderPropertyPage.java:927) 	at org.eclipse.jface.preference.PreferenceDialog$12.run(PreferenceDialog.java:922) 	at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:37) 	at org.eclipse.core.runtime.Platform.run(Platform.java:850) 	at org.eclipse.ui.internal.JFaceUtil$1.run(JFaceUtil.java:45) 	at org.eclipse.jface.util.SafeRunnable.run(SafeRunnable.java:193) 	at org.eclipse.jface.preference.PreferenceDialog.okPressed(PreferenceDialog.java:902) 	at org.eclipse.ui.internal.dialogs.FilteredPreferenceDialog.okPressed(FilteredPreferenceDialog.java:374) 	at org.eclipse.jface.preference.PreferenceDialog.buttonPressed(PreferenceDialog.java:230) 	at org.eclipse.jface.dialogs.Dialog$2.widgetSelected(Dialog.java:616) 	at org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:227) 	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1101) 	at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3320) 	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2972) 	at org.eclipse.jface.window.Window.runEventLoop(Window.java:820) 	at org.eclipse.jface.window.Window.open(Window.java:796) 	at org.eclipse.ui.dialogs.PropertyDialogAction.run(PropertyDialogAction.java:156) 	at org.eclipse.jface.action.Action.runWithEvent(Action.java:498) 	at org.eclipse.ui.actions.RetargetAction.runWithEvent(RetargetAction.java:229) 	at org.eclipse.jface.commands.ActionHandler.execute(ActionHandler.java:119) 	at org.eclipse.core.commands.Command.executeWithChecks(Command.java:471) 	at org.eclipse.core.commands.ParameterizedCommand.executeWithChecks(ParameterizedCommand.java:424) 	at org.eclipse.ui.internal.handlers.HandlerService.executeCommand(HandlerService.java:165) 	at org.eclipse.ui.internal.keys.WorkbenchKeyboard.executeCommand(WorkbenchKeyboard.java:467) 	at org.eclipse.ui.internal.keys.WorkbenchKeyboard.press(WorkbenchKeyboard.java:791) 	at org.eclipse.ui.internal.keys.WorkbenchKeyboard.processKeyEvent(WorkbenchKeyboard.java:838) 	at org.eclipse.ui.internal.keys.WorkbenchKeyboard.filterKeySequenceBindings(WorkbenchKeyboard.java:565) 	at org.eclipse.ui.internal.keys.WorkbenchKeyboard.access$3(WorkbenchKeyboard.java:507) 	at org.eclipse.ui.internal.keys.WorkbenchKeyboard$KeyDownFilter.handleEvent(WorkbenchKeyboard.java:124) 	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:66) 	at org.eclipse.swt.widgets.Display.filterEvent(Display.java:1424) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1100) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1125) 	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1110) 	at org.eclipse.swt.widgets.Control.traverse(Control.java:3903) 	at org.eclipse.swt.widgets.Control.translateTraversal(Control.java:3881) 	at org.eclipse.swt.widgets.Composite.translateTraversal(Composite.java:1291) 	at org.eclipse.swt.widgets.Control.gtk_key_press_event(Control.java:2381) 	at org.eclipse.swt.widgets.Composite.gtk_key_press_event(Composite.java:679) 	at org.eclipse.swt.widgets.Tree.gtk_key_press_event(Tree.java:1823) 	at org.eclipse.swt.widgets.Widget.windowProc(Widget.java:1486) 	at org.eclipse.swt.widgets.Control.windowProc(Control.java:4055) 	at org.eclipse.swt.widgets.Display.windowProc(Display.java:3974) 	at org.eclipse.swt.internal.gtk.OS._gtk_main_do_event(Native Method) 	at org.eclipse.swt.internal.gtk.OS.gtk_main_do_event(OS.java:5590) 	at org.eclipse.swt.widgets.Display.eventProc(Display.java:1193) 	at org.eclipse.swt.internal.gtk.OS._g_main_context_iteration(Native Method) 	at org.eclipse.swt.internal.gtk.OS.g_main_context_iteration(OS.java:1484) 	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:2970) 	at org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:2365) 	at org.eclipse.ui.internal.Workbench.runUI(Workbench.java:2329) 	at org.eclipse.ui.internal.Workbench.access$4(Workbench.java:2204) 	at org.eclipse.ui.internal.Workbench$4.run(Workbench.java:466) 	at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:289) 	at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:461) 	at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149) 	at org.eclipse.ui.internal.ide.application.IDEApplication.start(IDEApplication.java:106) 	at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:153) 	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:106) 	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:76) 	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:363) 	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:176) 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) 	at java.lang.reflect.Method.invoke(Method.java:597) 	at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:497) 	at org.eclipse.equinox.launcher.Main.basicRun(Main.java:436) 	at org.eclipse.equinox.launcher.Main.run(Main.java:1162) 	at org.eclipse.equinox.launcher.Main.main(Main.java:1137) Caused by: org.eclipse.swt.SWTException: Widget is disposed 	at org.eclipse.swt.SWT.error(SWT.java:3547) 	at org.eclipse.swt.SWT.error(SWT.java:3465) 	at org.eclipse.swt.SWT.error(SWT.java:3436) 	at org.eclipse.swt.widgets.Widget.error(Widget.java:438) 	at org.eclipse.swt.widgets.Widget.getDisplay(Widget.java:520) 	at org.eclipse.jface.dialogs.IconAndMessageDialog.getSWTImage(IconAndMessageDialog.java:271) 	at org.eclipse.jface.dialogs.IconAndMessageDialog.getInfoImage(IconAndMessageDialog.java:243) 	at org.eclipse.jface.dialogs.ProgressMonitorDialog.getImage(ProgressMonitorDialog.java:619) 	at org.eclipse.jface.dialogs.ProgressMonitorDialog.updateForClearBlocked(ProgressMonitorDialog.java:276) 	at org.eclipse.jface.dialogs.ProgressMonitorDialog$ProgressMonitor.clearBlocked(ProgressMonitorDialog.java:257) 	at org.eclipse.ui.internal.progress.ProgressMonitorJobsDialog$4.clearBlocked(ProgressMonitorJobsDialog.java:435) 	at org.eclipse.jface.operation.AccumulatingProgressMonitor$4.run(AccumulatingProgressMonitor.java:230) 	at org.eclipse.swt.widgets.RunnableLock.run(RunnableLock.java:35) 	at org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:123) 	... 81 more This bug might be similar to bug 87787.